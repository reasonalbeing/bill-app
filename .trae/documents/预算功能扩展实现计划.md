# 预算功能扩展实现计划

## 一、功能需求分析

### 核心需求
1. **盈余计算与展示**：在预算界面显示盈余项，盈余=预算-已花
2. **多预算周期支持**：扩展现有预算周期，支持日预算和自定义预算周期
3. **盈余转入功能**：将当期盈余转入下一预算周期，可设置转入金额
4. **多月份预算**：支持一次设置多个月份的预算，考虑月份天数差异
5. **AI集成**：所有功能支持手动操作和AI辅助

## 二、技术实现方案

### 1. 预算周期扩展
- **修改 BudgetScreen.js**：
  - 在重复类型选择中添加"每日"和"自定义"选项
  - 为自定义周期添加开始/结束日期选择器
  - 添加自定义重复频率设置（如每N天、每N周等）
- **修改 useBudgets.js**：
  - 更新 calculateBudgetSpending 函数，支持日预算和自定义预算的日期范围计算
  - 添加自定义周期的日期计算逻辑
- **修改 BudgetRepository.js**：
  - 更新 createRecurringBudget 方法，支持日预算和自定义预算的自动创建
  - 添加自定义周期的重复逻辑处理

### 2. 盈余功能实现
- **修改 BudgetScreen.js**：
  - 在预算卡片中添加盈余展示区域
  - 实现盈余转入按钮和操作界面
  - 添加转入金额输入和确认流程
- **修改 useBudgets.js**：
  - 添加 calculateBudgetSurplus 函数计算盈余
  - 添加 transferSurplus 函数处理盈余转入逻辑

### 3. 多月份预算支持
- **修改 BudgetScreen.js**：
  - 添加月份选择器，支持选择多个月份
  - 实现批量创建预算的表单
- **修改 useBudgets.js**：
  - 添加 createMultiMonthBudget 函数，处理多月份预算创建

### 4. AI集成
- **修改 BudgetScreen.js**：
  - 添加AI辅助按钮，集成现有的AIChatScreen
  - 实现AI建议的预算设置和盈余管理
- **创建 AI 相关服务**：
  - 扩展 aiService.js，添加预算相关的AI功能

### 5. 数据库和存储
- **检查数据库结构**：确保 budgets 表结构支持新增功能
- **添加必要字段**：如需扩展，添加相关字段支持新功能

## 三、实现步骤

### 第一阶段：基础功能扩展
1. 扩展预算周期类型，添加日预算和自定义预算支持
2. 实现盈余计算和展示功能
3. 添加盈余转入的核心逻辑

### 第二阶段：高级功能实现
1. 实现多月份预算设置功能
2. 集成AI辅助功能
3. 优化用户界面和交互体验

### 第三阶段：测试和优化
1. 功能测试：验证所有新功能正常工作
2. 性能优化：确保预算计算和展示流畅
3. 用户体验优化：调整界面布局和交互流程

## 四、关键技术点

1. **预算周期计算**：
   - 日预算：按自然日计算
   - 月预算：考虑不同月份的天数差异
   - 年预算：按公历年计算
   - 自定义预算：支持灵活的开始/结束日期和重复频率

2. **盈余转入逻辑**：
   - 计算当期盈余
   - 创建下一期预算并增加转入金额
   - 标记已转入的盈余，避免重复计算

3. **多月份预算**：
   - 批量创建多个月份的预算记录
   - 自动调整每个月的日期范围
   - 保持预算的一致性和可追溯性

4. **AI集成**：
   - 基于历史消费数据提供预算建议
   - 智能分析盈余情况，提供转入建议
   - 支持自然语言交互设置预算

## 五、预期效果

- 用户可以清晰查看各预算周期的盈余情况
- 支持灵活的预算周期设置（日、月、年、自定义）
- 可以方便地将盈余转入下一周期，优化资金使用
- 支持批量设置多个月份的预算，提高效率
- 通过AI辅助，获得更智能的预算管理建议

此实现计划将显著增强预算管理功能，为用户提供更全面、智能的财务管理工具。
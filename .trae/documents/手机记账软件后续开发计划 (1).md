## 开发计划概述

基于项目日志和需求分析，已完成数据持久化层（SQLite数据库、Repository层、Hooks）的开发。现在需要继续开发以下三个核心功能：

---

## 第一阶段：UI组件数据库集成
**目标**：将现有UI从模拟数据切换到真实数据库

### 1.1 账单列表页面改造 (TransactionsListScreen.js)
- 移除 `mockTransactions` 模拟数据
- 集成 `useTransactions` Hook 获取真实数据
- 集成 `useCategories` Hook 获取分类信息
- 实现真实的删除功能（调用 `deleteTransaction`）
- 添加加载状态显示
- 处理错误状态

### 1.2 添加账单页面改造 (AddTransactionScreen.js)
- 分类选择改为从数据库加载（使用 `useCategories`）
- 保存时调用 `createTransaction` 写入数据库
- 添加分类选择器（Picker/Modal）替代文本输入
- 添加日期选择器
- 保存成功后刷新列表并返回

### 1.3 统计分析页面改造 (StatisticsScreen.js)
- 移除 `mockStatistics` 模拟数据
- 集成 `useTransactions` 获取统计数据
- 实现按时间范围筛选（日/周/月/年）
- 动态计算分类统计和趋势数据
- 实现平台统计功能

### 1.4 预算管理页面改造 (BudgetScreen.js)
- 移除 `mockBudgets` 模拟数据
- 创建 `useBudgets` Hook
- 集成真实预算数据CRUD操作
- 实现预算与实际支出的关联计算

---

## 第二阶段：第三方账单导入功能
**目标**：支持支付宝/微信账单CSV导入

### 2.1 文件选择器集成
- 安装 `expo-document-picker`
- 创建文件选择组件
- 支持CSV/Excel文件格式

### 2.2 CSV解析器开发
- 安装 `papaparse` 库
- 创建通用CSV解析服务
- 实现字段映射配置

### 2.3 支付宝账单解析器
- 分析支付宝账单CSV格式
- 实现字段映射（时间、金额、类型、商户、备注等）
- 处理支付宝特有的交易类型（转账、红包、退款等）

### 2.4 微信账单解析器
- 分析微信账单CSV格式
- 实现字段映射
- 处理微信特有的交易类型

### 2.5 导入预览与确认
- 创建导入预览页面
- 显示解析后的数据列表
- 支持编辑和删除单条记录
- 实现批量导入到数据库
- 重复数据检测与提示

### 2.6 导入历史记录
- 记录每次导入的源文件、时间、数量
- 支持查看和撤销导入

---

## 第三阶段：AI功能API配置
**目标**：创建设置页面支持用户配置API密钥

### 3.1 数据库扩展
- 扩展 `settings` 表支持AI配置
- 添加字段：api_provider, api_key, api_endpoint, model_name, is_enabled

### 3.2 AI配置页面开发
- 创建 `AIConfigScreen.js`
- 支持选择API提供商（硅基流动、OpenAI、Anthropic等）
- 输入API密钥（加密存储）
- 配置模型参数（温度、最大token等）
- 测试连接功能

### 3.3 API配置存储服务
- 创建 `aiConfigService.js`
- 实现配置的CRUD操作
- API密钥加密存储（使用设备Keychain/Keystore）

### 3.4 设置页面入口
- 在 `SettingsScreen.js` 添加"AI服务配置"选项
- 导航到AI配置页面

### 3.5 支持的API提供商
- 硅基流动（Silicon Flow）- DeepSeek V3.2
- OpenAI - GPT-4o-mini
- Anthropic - Claude Haiku
- 百度 - 文心一言
- 阿里云 - 通义千问

---

## 技术实现细节

### 依赖安装
```bash
# 第二阶段
npm install expo-document-picker papaparse

# 第三阶段
npm install expo-secure-store  # 用于安全存储API密钥
```

### 文件结构变更
```
src/
├── components/
│   ├── settings/
│   │   ├── SettingsScreen.js
│   │   └── AIConfigScreen.js      # 新增
│   └── import/
│       ├── ImportScreen.js        # 新增
│       └── ImportPreviewScreen.js # 新增
├── services/
│   ├── authService.js
│   ├── csvParserService.js        # 新增
│   ├── aiConfigService.js         # 新增
│   └── aiService.js               # 新增（预留）
├── hooks/
│   ├── useTransactions.js
│   ├── useCategories.js
│   └── useBudgets.js              # 新增
└── utils/
    └── encryption.js              # 新增（加密工具）
```

---

## 开发顺序建议

1. **第一阶段**（预计2-3天）
   - 先改造 TransactionsListScreen（数据展示）
   - 再改造 AddTransactionScreen（数据写入）
   - 然后改造 StatisticsScreen（数据统计）
   - 最后改造 BudgetScreen（预算管理）

2. **第二阶段**（预计3-4天）
   - 先实现文件选择和CSV解析
   - 再实现支付宝账单解析
   - 然后实现微信账单解析
   - 最后实现导入预览和确认

3. **第三阶段**（预计2天）
   - 先实现数据库扩展和配置存储
   - 再开发AI配置页面
   - 最后集成到设置页面

---

## 预期成果

- ✅ 所有UI组件使用真实数据库数据
- ✅ 支持支付宝、微信CSV账单导入
- ✅ 用户可配置AI API密钥（支持硅基流动DS V3.2等）
- ✅ 数据导入支持预览和重复检测
- ✅ API密钥安全加密存储

---

**确认后，我将开始第一阶段"UI组件数据库集成"的具体实施。**
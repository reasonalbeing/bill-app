# 手机记账软件数据库设计

## 1. 数据库表结构

### 1.1 用户表（users）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| `id` | INTEGER | PRIMARY KEY AUTOINCREMENT | 用户ID |
| `username` | VARCHAR(50) | NOT NULL | 用户名 |
| `email` | VARCHAR(100) | UNIQUE NOT NULL | 邮箱 |
| `password` | VARCHAR(255) | NOT NULL | 加密后的密码 |
| `avatar` | VARCHAR(255) | | 头像URL |
| `default_currency` | VARCHAR(10) | DEFAULT 'CNY' | 默认货币 |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| `updated_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

### 1.2 账单表（transactions）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| `id` | INTEGER | PRIMARY KEY AUTOINCREMENT | 账单ID |
| `user_id` | INTEGER | REFERENCES users(id) | 用户ID |
| `amount` | DECIMAL(12,2) | NOT NULL | 金额 |
| `type` | VARCHAR(10) | NOT NULL | 类型（income/expense） |
| `category_id` | INTEGER | REFERENCES categories(id) | 分类ID |
| `payment_method` | VARCHAR(50) | | 支付方式 |
| `platform` | VARCHAR(20) | | 平台（alipay/wechat/other） |
| `date` | DATE | NOT NULL | 交易日期 |
| `time` | TIME | | 交易时间 |
| `description` | TEXT | | 描述 |
| `location` | VARCHAR(255) | | 交易地点 |
| `receipt_image` | VARCHAR(255) | | 收据图片URL |
| `is_imported` | BOOLEAN | DEFAULT FALSE | 是否为导入数据 |
| `import_source` | VARCHAR(50) | | 导入来源 |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| `updated_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

### 1.3 分类表（categories）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| `id` | INTEGER | PRIMARY KEY AUTOINCREMENT | 分类ID |
| `user_id` | INTEGER | REFERENCES users(id) | 用户ID（NULL表示系统默认分类） |
| `name` | VARCHAR(50) | NOT NULL | 分类名称 |
| `type` | VARCHAR(10) | NOT NULL | 类型（income/expense） |
| `icon` | VARCHAR(50) | | 图标名称 |
| `color` | VARCHAR(20) | | 颜色代码 |
| `order_index` | INTEGER | DEFAULT 0 | 排序索引 |
| `is_default` | BOOLEAN | DEFAULT FALSE | 是否为默认分类 |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| `updated_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

### 1.4 预算表（budgets）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| `id` | INTEGER | PRIMARY KEY AUTOINCREMENT | 预算ID |
| `user_id` | INTEGER | REFERENCES users(id) | 用户ID |
| `amount` | DECIMAL(12,2) | NOT NULL | 预算金额 |
| `category_id` | INTEGER | REFERENCES categories(id) | 分类ID（NULL表示总预算） |
| `start_date` | DATE | NOT NULL | 开始日期 |
| `end_date` | DATE | NOT NULL | 结束日期 |
| `recurring` | VARCHAR(20) | | 重复类型（none/daily/weekly/monthly/yearly） |
| `description` | TEXT | | 描述 |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| `updated_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

### 1.5 货币表（currencies）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| `id` | INTEGER | PRIMARY KEY AUTOINCREMENT | 货币ID |
| `code` | VARCHAR(10) | UNIQUE NOT NULL | 货币代码（如CNY、USD） |
| `name` | VARCHAR(50) | NOT NULL | 货币名称 |
| `symbol` | VARCHAR(10) | NOT NULL | 货币符号 |
| `exchange_rate` | DECIMAL(10,6) | DEFAULT 1.0 | 对默认货币的汇率 |
| `is_active` | BOOLEAN | DEFAULT TRUE | 是否启用 |

### 1.6 设置表（settings）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| `id` | INTEGER | PRIMARY KEY AUTOINCREMENT | 设置ID |
| `user_id` | INTEGER | REFERENCES users(id) | 用户ID |
| `key` | VARCHAR(50) | NOT NULL | 设置键 |
| `value` | TEXT | | 设置值 |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| `updated_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

### 1.7 AI规则表（ai_rules）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| `id` | INTEGER | PRIMARY KEY AUTOINCREMENT | 规则ID |
| `user_id` | INTEGER | REFERENCES users(id) | 用户ID |
| `type` | VARCHAR(50) | NOT NULL | 规则类型（category_detection/text_recognition等） |
| `pattern` | TEXT | NOT NULL | 匹配模式 |
| `action` | TEXT | NOT NULL | 执行动作 |
| `confidence` | DECIMAL(3,2) | DEFAULT 0.8 | 置信度阈值 |
| `is_active` | BOOLEAN | DEFAULT TRUE | 是否启用 |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| `updated_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

## 2. 表关系图

```
+-----------+       +----------------+       +-------------+
|  users    |<------|  transactions  |------>|  categories |
+-----------+       +----------------+       +-------------+
|           |       |                |       |             |
|           |       +----------------+       |             |
|           |       |                |       |             |
|           |       +----------------+       |             |
|           |       |                |       |             |
+-----------+       |    budgets     |       +-------------+
        |           |                |
        |           +----------------+
        |           |                |
        |           +----------------+
        |           |                |
        v           v                v
+-----------+   +-----------+   +-------------+
| settings  |   | currencies|   |   ai_rules  |
+-----------+   +-----------+   +-------------+
```

## 3. 数据模型设计考虑

### 3.1 本地存储与云同步
- **本地存储**：使用SQLite作为本地数据库，确保离线使用
- **云同步**：通过API将数据同步到云端，支持多设备访问

### 3.2 数据安全
- **密码加密**：使用bcrypt等算法加密存储用户密码
- **本地数据加密**：对敏感数据进行本地加密
- **传输加密**：使用HTTPS进行数据传输

### 3.3 性能优化
- **索引**：在常用查询字段上创建索引，如用户ID、日期、分类ID等
- **缓存**：对频繁访问的数据进行缓存
- **分页查询**：对大量数据采用分页查询策略

### 3.4 扩展性考虑
- **模块化设计**：将数据模型设计为模块化，便于后续功能扩展
- **预留字段**：在关键表中预留一些字段，以适应未来需求变化
- **插件架构**：支持通过插件扩展数据模型

## 4. 初始数据

### 4.1 默认分类

#### 支出分类
- 餐饮
- 交通
- 购物
- 娱乐
- 医疗
- 教育
- 房租
- 水电费
- 通讯费
- 其他

#### 收入分类
- 工资
- 奖金
- 投资收益
- 兼职
- 礼金
- 其他

### 4.2 默认货币
- CNY（人民币）
- USD（美元）
- EUR（欧元）
- JPY（日元）
- KRW（韩元）

### 4.3 默认设置
- 默认货币：CNY
- 预算周期：月度
- 语言：简体中文
- 主题：浅色

## 5. 数据迁移策略

- **版本控制**：对数据库结构进行版本控制
- **自动迁移**：在应用启动时检查数据库版本，自动执行迁移脚本
- **备份恢复**：提供数据备份和恢复功能，确保数据安全

## 6. 总结

本数据库设计方案涵盖了手机记账软件的核心功能需求，包括用户管理、账单记录、分类管理、预算管理、货币管理、系统设置和AI规则管理等。通过合理的表结构设计和关系定义，确保了数据的完整性、一致性和可扩展性，为后续的功能开发奠定了坚实的基础。
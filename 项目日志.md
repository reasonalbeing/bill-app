# 项目开发日志

## 项目概述

本文档详细记录了手机记账软件的完整开发过程，包括每个功能的实现方式、技术原理以及开发过程中遇到的问题和解决方案。本文档旨在帮助开发人员理解整个项目的架构设计和代码实现逻辑。

---

## 一、项目技术架构

### 1.1 技术栈介绍

本项目采用React Native框架进行移动应用开发，使用Expo作为开发工具链。这一技术选型具有以下优势：首先，React Native允许使用JavaScript和React语法同时开发iOS和Android两个平台的应用，大大提高了开发效率；其次，Expo提供了一套完整的开发环境，包括开发服务器、构建工具和运行时环境，使得项目的启动和调试变得非常简单；再次，React Native拥有庞大的社区支持和丰富的第三方组件库，可以快速实现各种功能需求。

在具体的技术版本选择上，项目使用了React 18.2.0版本，这是一个相对稳定且功能完善的版本，提供了更好的并发处理能力和性能优化。React Native的版本为0.76.6，这是Expo 54所支持的最新版本。导航系统采用了React Navigation 7.x版本，包括底部标签导航（@react-navigation/bottom-tabs）和原生堆栈导航（@react-navigation/native-stack）两个主要模块。

后端服务方面，项目集成了Firebase Authentication用于用户身份认证。Firebase是Google提供的移动开发平台，其认证服务支持邮箱密码登录、手机号登录、社交账号登录等多种方式，并且提供了完善的安全机制和数据同步功能。数据库设计文档中详细规划了七张核心数据表，包括用户表、账单表、分类表、预算表、货币表、设置表和AI规则表，为后续的功能开发奠定了坚实的数据基础。

### 1.2 项目目录结构

项目的源代码组织结构遵循了模块化和关注点分离的设计原则。src目录是源代码的根目录，下面分为components（组件）、config（配置）、navigation（导航）和services（服务）四个子目录。

components目录包含了应用的所有UI组件，按照功能模块进行组织。auth子目录存放与用户认证相关的组件，包括登录页面（LoginScreen.js）、注册页面（RegisterScreen.js）和密码重置页面（ResetPasswordScreen.js）。transactions子目录存放与账单管理相关的组件，包括添加账单页面（AddTransactionScreen.js）和账单列表页面（TransactionsListScreen.js）。statistics子目录存放统计分析页面（StatisticsScreen.js），budget子目录存放预算管理页面（BudgetScreen.js），settings子目录存放系统设置页面（SettingsScreen.js）。

config目录目前只包含firebase.js配置文件，用于初始化Firebase SDK并导出认证实例。services目录包含authService.js认证服务模块，封装了用户注册、登录、登出、密码重置等核心认证功能。navigation目录包含AppNavigator.js和MainTabNavigator.js两个导航配置文件，分别负责根导航栈和底部标签导航的配置。

---

## 二、核心功能实现详解

### 2.1 用户认证系统

用户认证系统是整个应用的基础功能，负责管理用户的注册、登录和密码找回流程。该系统基于Firebase Authentication服务构建，利用其安全可靠的用户管理机制，确保用户数据的安全性。

#### 2.1.1 认证服务模块（authService.js）

认证服务模块是整个认证系统的核心，封装了所有与Firebase Authentication交互的函数。该模块使用ES6的export语法向外暴露六个主要函数：registerUser用于新用户注册，loginUser用于用户登录，resetPassword用于发送密码重置邮件，logoutUser用于用户登出，onAuthStateChanged用于监听认证状态变化，getCurrentUser用于获取当前登录用户信息。

在注册功能实现中，createUserWithEmailAndPassword函数接收邮箱和密码参数，创建用户账号后返回用户凭证对象。注册成功后，可以在回调函数中将用户信息同步到应用的数据库中。登录功能使用signInWithEmailAndPassword函数，验证用户凭据后返回会话信息。密码重置功能通过sendPasswordResetEmail函数实现，该函数会向用户邮箱发送包含重置链接的邮件。认证状态监听使用onAuthStateChanged回调，当用户登录或登出状态发生变化时会自动触发回调函数，这对于实现自动登录和会话保持功能非常重要。

#### 2.1.2 登录页面实现（LoginScreen.js）

登录页面是用户进入应用后的第一个界面，提供了邮箱密码登录和导航到其他认证页面的功能。页面采用React的函数式组件写法，使用useState Hook管理邮箱、密码和加载状态三个状态变量。

页面的UI布局使用View组件构建容器，KeyboardAvoidingView组件处理键盘弹出时的视图调整问题（iOS平台使用padding行为，Android平台使用height行为）。表单部分包含邮箱输入框和密码输入框，分别使用TextInput组件实现。邮箱输入框配置了keyboardType="email-address"属性以调出适合输入邮箱的键盘，autoCapitalize="none"属性防止首字母自动大写。密码输入框配置了secureTextEntry属性以隐藏输入内容。

登录按钮的onPress事件处理器首先验证输入不为空，然后调用authService中的loginUser函数。调用使用try-catch-finally结构处理异步操作，成功时使用navigation.replace方法切换到主界面（使用replace而非navigate可以防止用户返回登录页面），失败时使用Alert组件显示错误信息。注册入口和忘记密码入口分别使用TouchableOpacity组件实现点击导航。

#### 2.1.3 注册页面实现（RegisterScreen.js）

注册页面提供了创建新用户账号的功能，界面设计与登录页面保持一致性。页面状态包括用户名、邮箱、密码、确认密码和加载状态五个变量。

注册表单验证逻辑包含四个层次：首先验证所有字段都不为空；其次验证两次输入的密码是否一致；再次验证密码长度是否达到6位以上；最后调用认证服务进行实际的注册操作。注册成功后，调用Alert.alert显示成功提示，然后导航回登录页面。与登录页面类似，注册按钮也使用isLoading状态控制按钮的禁用和显示文本的切换，防止重复提交。

#### 2.1.4 密码重置页面实现（ResetPasswordScreen.js）

密码重置页面允许用户通过邮箱重置密码。页面设计包含两种状态的UI展示：未发送邮件时显示邮箱输入表单，发送成功后显示成功提示信息。

状态变量isSent用于跟踪邮件发送状态。当用户点击发送按钮后，调用resetPassword函数向Firebase发送重置请求。由于Firebase的密码重置邮件发送是异步操作，调用在try-catch块中执行，成功后设置isSent为true切换UI显示。成功提示信息告诉用户检查邮箱（包括垃圾邮件箱）并点击链接完成密码重置。

---

### 2.2 记账功能模块

记账功能是应用的核心业务功能，实现了收支记录的添加、查询、筛选和删除等操作。

#### 2.2.1 添加账单页面（AddTransactionScreen.js）

添加账单页面提供了手动录入收支记录的功能。页面状态包括收支类型（type）、金额（amount）、分类（category）、描述（description）、日期（date）、支付方式（paymentMethod）和平台（platform）七个变量。

收支类型切换使用两个TouchableOpacity组件并排布局，点击时更新type状态为'expense'或'income'，同时动态调整按钮的样式（选中状态使用蓝色背景）。金额输入使用TextInput组件，配置keyboardType="decimal-pad"调出数字键盘。分类输入目前使用文本框，未来可以扩展为从预设分类列表中选择。

平台选择使用三个按钮分别代表支付宝、微信和其他平台，点击时更新platform状态。支付方式和日期字段使用普通文本输入框，日期字段预填充当前日期。描述字段使用multiline和numberOfLines属性配置为多行文本区域。保存按钮的onPress处理器验证必填字段后调用保存逻辑（目前使用Alert显示成功提示）。

#### 2.2.2 账单列表页面（TransactionsListScreen.js）

账单列表页面以列表形式展示所有记账记录，支持按收支类型进行筛选。页面目前使用模拟数据进行开发和测试。

页面使用FlatList组件渲染账单列表，相比Map+View方案，FlatList提供了更好的性能优化，包括视口渲染、滚动监听等高级功能。筛选功能通过filter状态变量控制，过滤后的数据通过filter方法根据type进行筛选。空列表时显示友好提示。

账单列表项使用View组件构建，包含左侧的信息区域（分类、描述、日期）和右侧的详情区域（金额、平台、删除按钮）。金额根据类型显示不同颜色：支出显示红色，收入显示绿色。平台图标使用@expo/vector-icons库中的Ionicons组件，根据平台类型显示不同的图标。删除功能使用Alert组件进行二次确认，防止误操作。

---

### 2.3 统计功能模块

统计功能模块提供了多维度的财务数据分析能力，帮助用户了解收支状况和消费趋势。

#### 2.3.1 统计分析页面（StatisticsScreen.js）

统计分析页面整合了收支总览、分类统计、趋势分析和平台统计四个模块，提供全面的财务数据可视化。

时间范围选择器允许用户切换日、周、月、年四种统计周期。点击不同按钮时更新timeRange状态，触发相应的数据重新计算（目前使用模拟数据展示UI效果）。

收支总览卡片显示总收入、总支出和结余三项核心指标。卡片使用Flex布局将三项指标水平排列，使用不同的颜色标识收入（绿色）、支出（红色）和结余（黑色）。

分类统计模块使用水平进度条展示各类别的支出占比。进度条通过计算各类别金额占总支出百分比来设置宽度百分比，使用View组件的宽度样式实现视觉效果。

每日收支趋势使用柱状图形式展示最近几天的收支情况。图表通过计算每日金额与最大金额的比例来动态设置柱子的高度，区分收入（绿色）和支出（红色）两种柱子。

平台统计模块展示各支付渠道的消费情况，使用图标+名称+金额的列表形式，每个平台使用对应的品牌颜色和图标。

---

### 2.4 预算功能模块

预算功能模块允许用户设置和管理个人预算，帮助控制消费支出。

#### 2.4.1 预算管理页面（BudgetScreen.js）

预算管理页面实现了预算的查看、添加和删除功能。页面状态包括预算列表、是否显示添加表单和新增预算表单数据三个变量。

添加预算功能使用可折叠的表单实现，点击"添加预算"按钮切换表单的显示隐藏。表单包含预算金额、预算分类、开始日期、结束日期和重复类型五个字段。重复类型使用三个按钮切换选择，支持不重复、每月重复和每年重复三种模式。表单验证确保金额和分类不为空。

预算列表以卡片形式展示每个预算的详细信息，包括预算金额、已花费金额、剩余金额、预算进度条、预算周期和重复模式。进度条宽度根据已花费金额占预算金额的百分比动态计算，使用条件样式渲染不同颜色（超支情况可添加红色预警）。

---

## 三、导航系统设计

### 3.1 根导航栈配置（AppNavigator.js）

根导航栈使用NavigationContainer组件作为导航系统的根容器，提供上下文和状态管理。createNativeStackNavigator创建原生堆栈导航器，支持iOS和Android平台特有的导航过渡动画。

导航栈配置了四个屏幕：Login（登录）、Register（注册）、ResetPassword（密码重置）和Main（主界面）。使用screenOptions设置全局选项，headerShown: false隐藏默认的导航头，因为应用使用了自定义的页面标题设计。

初始路由设置为Login，确保用户首次打开应用时看到登录页面。登录成功后使用navigation.replace('Main')切换到主界面，replace方法会从导航历史中移除登录页面，防止用户返回。

### 3.2 底部标签导航配置（MainTabNavigator.js）

底部标签导航使用createBottomTabNavigator创建，包含五个功能标签：AddTransaction（记账）、Transactions（账单）、Statistics（统计）、Budget（预算）和Settings（设置）。

每个标签使用Ionicons图标展示，图标名称根据选中状态动态变化（选中时使用filled版本，未选中使用outline版本）。tabBarActiveTintColor设置选中标签的颜色为蓝色（#007AFF），tabBarInactiveTintColor设置未选中标签的颜色为灰色。

每个Tab.Screen可以配置独立的头部标题（headerTitle），在 StatisticsScreen 和其他页面中通过headerTitle配置显示"统计分析"等中文标题。

---

## 四、数据库设计说明

### 4.1 核心数据表结构

数据库设计文档定义了七个核心数据表，为应用的数据存储提供了完整的设计方案。

用户表（users）存储用户账号信息，包含唯一标识id、用户名username、邮箱email（唯一约束）、加密密码password、头像avatar、默认货币default_currency和创建更新时间戳。该表是其他所有数据表的外键关联基础。

账单表（transactions）存储每笔收支记录，包含用户id外键、金额amount、类型type（income/expense）、分类id外键、支付方式paymentMethod、平台platform（alipay/wechat/other）、日期date、时间time、描述description、地点location、收据图片receipt_image、导入标记is_imported和导入来源import_source。复合索引应建立在user_id和date字段上以优化常用查询。

分类表（categories）存储收支分类，支持系统默认分类和用户自定义分类。包含分类名称name、类型type（income/expense）、图标icon、颜色color、排序索引order_index和默认分类标记is_default。

预算表（budgets）存储预算设置，包含用户id外键、金额amount、分类id外键（null表示总预算）、开始日期start_date、结束日期end_date、重复类型recurring（none/daily/weekly/monthly/yearly）和描述description。

AI规则表（ai_rules）存储用户配置的消费识别规则，包含规则类型type、匹配模式pattern、执行动作action、置信度阈值confidence和启用状态is_active。该表为未来的AI智能记账功能预留。

### 4.2 数据关系模型

各表之间通过外键建立关联关系。用户与账单是一对多关系，一个用户可以有多条账单记录。每条账单记录关联一个分类，分类表通过user_id区分系统默认分类和用户自定义分类。预算表同样关联用户和可选的分类，支持总预算和分类预算两种模式。

---

## 五、开发过程记录

### 5.1 环境配置问题及解决

项目开发过程中遇到了多个环境配置问题，已按时间顺序记录在项目日志中。主要问题包括：目录权限问题、PowerShell执行策略限制、React与ReactDOM版本冲突、Expo启动命令失败、模块解析错误和依赖安装权限问题等。

React版本冲突是最核心的技术障碍。最初安装的React 19.x与Expo 54存在不兼容问题，表现为react-jsx-runtime.production.min.js模块解析错误。解决方案是将React和ReactDOM版本统一降级到18.2.0，并使用npm install --legacy-peer-deps标志处理依赖版本冲突。

### 5.2 功能开发进度

项目已完成用户认证系统（登录、注册、密码重置）的完整实现，记账功能的基础UI和交互设计，统计分析页面的界面设计和模拟数据展示，以及预算管理功能的添加和展示逻辑。数据库设计文档已完成全部七张核心表的设计。

待开发功能包括：第三方账单导入（支付宝/微信账单解析）、AI智能功能（聊天记账、截图识别）、真实数据集成（替代模拟数据）、数据持久化（SQLite数据库）、云同步功能等。

---

## 六、后续开发建议

### 6.1 数据持久化方案

建议使用SQLite作为本地数据库，Expo提供了expo-sqlite包便于集成。账单数据应实现本地存储和云端同步的双写策略，确保数据安全和多设备访问。数据库初始化应在应用启动时执行，检查数据库版本并执行迁移脚本。

### 6.2 第三方账单导入技术方案

微信和支付宝账单导出为CSV或Excel格式，需要实现解析器提取关键字段（金额、时间、交易对象、备注）。建议使用react-native-fs进行文件访问，papaparse进行CSV解析。解析后的数据需要与数据库设计字段进行映射，并处理数据清洗和格式统一。

### 6.3 AI功能集成方向

聊天记账可集成自然语言处理能力，将用户输入的自然语言转换为结构化的账单数据。截图识别可集成OCR服务，从收据图片中提取金额、日期、商户等信息。建议先实现基础功能，未来考虑接入大语言模型API提升智能程度。

---

## 七、文件清单

### 7.1 源代码文件

主要源代码文件包括：App.js（应用入口）、package.json（项目配置）、src/navigation/AppNavigator.js（根导航配置）、src/navigation/MainTabNavigator.js（标签导航配置）、src/services/authService.js（认证服务）、src/config/firebase.js（Firebase配置），以及src/components下的各个页面组件文件。

### 7.2 文档文件

项目文档包括：需求描述.md（功能需求文档）、数据库设计.md（数据库设计文档）、项目日志.md（开发过程记录）。dist目录包含导出的Web版本产物。

---

## 九、版本管理记录

### 9.1 Git仓库配置信息

**仓库初始化时间**：2026-02-06
**当前分支名称**：master
**远程仓库**：已配置 GitHub 仓库

**GitHub远程仓库配置**：
- 仓库地址：https://github.com/reasonalbeing/bill-app
- 仓库名称：bill-app
- 仓库所有者：reasonalbeing
- 默认分支：main
- 仓库类型：公开仓库
- 创建时间：2026-02-06 06:23:04 UTC

**Git用户配置**：
- 用户名：reasonalbeing
- 邮箱：3973363899@qq.com

**分支策略**：
- 主分支（master）：稳定版本，始终保持可运行状态
- 功能分支（feature/*）：开发新功能时创建，完成后合并到主分支

**远程仓库操作命令**：
```powershell
# 添加远程仓库
git remote add origin https://github.com/reasonalbeing/bill-app.git

# 推送代码到GitHub
git push -u origin master

# 拉取最新代码
git pull origin master
```

**代码同步状态**：
- ✅ 本地代码已成功推送到GitHub
- ✅ GitHub仓库包含完整的提交历史
- ✅ 远程仓库与本地仓库保持同步

### 9.2 提交历史记录

| 提交ID | 提交信息 | 日期 | 说明 |
|--------|----------|------|------|
| 2d45f7e | 初始化项目：建立React Native + Expo基础架构 | 2026-02-06 | 首次提交，包含所有已开发功能 |

**提交详情（2d45f7e）**：
```
初始化项目：建立React Native + Expo基础架构

- 集成Firebase用户认证系统（登录、注册、密码重置）
- 实现记账功能模块（添加账单、账单列表、筛选删除）
- 开发统计分析功能（收支总览、分类统计、趋势分析）
- 完成预算管理功能（添加预算、进度展示）
- 配置React Navigation双层导航结构
- 建立完整的数据库设计文档
```

### 9.3 版本回退指南

#### 回退到初始版本（仅做参考，不推荐）

如果后续开发出现问题，需要回退到初始版本状态，执行以下命令：

```powershell
git checkout 2d45f7e
```

此命令会将代码切换到第一次提交的状态，但不会创建新提交。如果想要创建新分支保存初始版本：

```powershell
git checkout -b v0.1.0-backup 2d45f7e
```

#### 查看历史版本

```powershell
# 查看简洁历史
git log --oneline

# 查看详细历史
git log

# 查看某个提交的具体内容
git show 2d45f7e
```

#### 创建标签标记里程碑

```powershell
# 为当前版本打标签
git tag -a v0.1.0 -m "初始功能版本：包含认证、记账、统计、预算功能"

# 查看所有标签
git tag

# 查看标签详情
git show v0.1.0
```

### 9.4 日常开发流程

#### 提交代码（每次完成功能后执行）

```powershell
git add .
git commit -m "描述：做了什么修改"
git push
```

#### 创建新功能分支

```powershell
# 从主分支创建新分支
git checkout -b feature/新功能名称

# 开发完成后合并到主分支
git checkout master
git merge feature/新功能名称
```

#### 恢复误删文件

```powershell
# 查看删除记录
git reflog

# 恢复文件
git checkout <commit-id> -- 文件路径
```

### 9.5 文件追踪状态

**已纳入版本控制的文件**：
- 所有源代码文件（src/ 目录）
- 项目配置文件（package.json, .gitignore）
- 设计文档（需求描述.md, 数据库设计.md, 项目日志.md）

**已忽略的文件**：
- node_modules/（依赖包目录）
- .expo/（Expo开发缓存）
- dist/（构建产物）
- 操作系统临时文件

### 9.6 后续操作建议

**强烈建议配置远程仓库**：

```powershell
# 创建GitHub仓库后执行
git remote add origin https://github.com/您的用户名/bill-app.git
git push -u origin master
```

配置远程仓库后，您可以实现：
- 代码云端备份（防止本地电脑故障丢失）
- 多设备同步开发
- 团队协作（未来需要时）

---

## 十、总结

本项目已完成基础的移动记账应用框架搭建，包括用户认证系统、记账功能、统计分析和预算管理四大核心模块。技术架构采用React Native + Expo的跨平台方案，确保了代码复用率和开发效率。数据库设计充分考虑了业务扩展需求，提供了完善的数据模型支撑。后续开发应重点推进真实数据集成、第三方账单导入和AI智能功能集成，提升应用的实用价值和用户体验。

版本管理体系已建立，所有代码变更都有完整记录。后续开发请遵循版本管理规范，每次完成功能后及时提交并推送至远程仓库。

---

**文档更新时间：2026-02-06**

**文档版本：2.0**
